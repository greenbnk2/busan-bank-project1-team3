<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<body>
    <!-- 사이드바 Fragment -->
    <aside class="sidebar" th:fragment="sidebar(activeMenu)">
        <div class="sidebar-header">
            <div class="header-content">
                <a th:href="@{/admin/main}">
                    <img th:src="@{/images/main/h1_busanbank_new.png}" alt="BNK 부산은행" class="sidebar-logo">
                </a>
                <span class="admin-label">관리자</span>
            </div>
        </div>
        <nav class="sidebar-menu">
            <ul>
                <!-- 펀드 관리 - CS는 펀드 목록만, ADM/SAD는 전체 -->
                <li class="menu-item has-submenu" 
                    th:classappend="${activeMenu != null && (activeMenu == 'product-list' || activeMenu == 'product-register' || activeMenu == 'product-pending' || activeMenu == 'product-edit' || activeMenu == 'product-documents') ? 'open' : ''}"
                    sec:authorize="hasAnyRole('ADM', 'SAD', 'CS')">
                    <a href="#" onclick="toggleSubmenu(this.parentElement); return false;">펀드 관리</a>
                    <ul class="submenu">
                        <li><a th:href="@{/admin/product}" 
                               th:classappend="${activeMenu == 'product-list' ? 'active' : ''}">펀드 목록</a></li>
                        <!-- CS는 펀드 목록만, ADM/SAD는 추가 메뉴 표시 -->
                        <li sec:authorize="hasAnyRole('ADM', 'SAD')">
                            <a th:href="@{/admin/product/pending}" 
                               th:classappend="${activeMenu == 'product-pending' ? 'active' : ''}">펀드 관리</a>
                        </li>
                        <li sec:authorize="hasAnyRole('ADM', 'SAD')">
                            <a th:href="@{/admin/product/status}"
                               th:classappend="${activeMenu == 'product-status' ? 'active' : ''}">펀드 가입 현황</a>
                        </li>
                    </ul>
                </li>
                
                <!-- 회원 관리 - CS는 회원 관리만, ADM/SAD는 전체 -->
                <li class="menu-item has-submenu"
                    th:classappend="${activeMenu != null && (activeMenu == 'member' || activeMenu == 'permission') ? 'open' : ''}"
                    sec:authorize="hasAnyRole('ADM', 'SAD', 'CS')">
                    <a href="#" onclick="toggleSubmenu(this.parentElement); return false;">회원 관리</a>
                    <ul class="submenu">
                        <li><a th:href="@{/admin/member/list}"
                               th:classappend="${activeMenu == 'member' ? 'active' : ''}">회원 관리</a></li>
                        <!-- SAD만 표시 -->
                        <li sec:authorize="hasRole('SAD')">
                            <a th:href="@{/admin/member/permission}"
                               th:classappend="${activeMenu == 'permission' ? 'active' : ''}">권한 관리</a>
                        </li>
                    </ul>
                </li>
                
                <!-- 정보/공시 - CS는 숨김, ADM/SAD만 -->
                <li class="menu-item has-submenu"
                    th:classappend="${activeMenu != null && (activeMenu == 'info-disclosures' || activeMenu == 'info-ad-hoc' || activeMenu == 'info-fund-info' || activeMenu == 'info-guide' || activeMenu == 'info-fund-market') ? 'open' : ''}"
                    sec:authorize="hasAnyRole('ADM', 'SAD')">
                    <a href="#" onclick="toggleSubmenu(this.parentElement); return false;">정보/공시</a>
                    <ul class="submenu">
                        <li><a th:href="@{/admin/info/disclosures}"
                               th:classappend="${activeMenu == 'info-disclosures' ? 'active' : ''}">공시 자료</a></li>
                        <li><a th:href="@{/admin/info/ad-hoc}"
                               th:classappend="${activeMenu == 'info-ad-hoc' ? 'active' : ''}">수시 공시</a></li>
                        <li><a th:href="@{/admin/info/fund-info}"
                               th:classappend="${activeMenu == 'info-fund-info' ? 'active' : ''}">펀드 정보</a></li>
                        <li><a th:href="@{/admin/info/guide}"
                               th:classappend="${activeMenu == 'info-guide' ? 'active' : ''}">펀드가이드</a></li>
                        <li><a th:href="@{/admin/info/fund-market}"
                               th:classappend="${activeMenu == 'info-fund-market' ? 'active' : ''}">펀드시황관리</a></li>
                    </ul>
                </li>
                
                <!-- 고객 지원 - CS, ADM, SAD 모두 -->
                <li class="menu-item has-submenu" 
                    th:classappend="${activeMenu != null && (activeMenu == 'faq' || activeMenu == 'qna') ? 'open' : ''}"
                    sec:authorize="hasAnyRole('CS', 'ADM', 'SAD')">
                    <a href="#" onclick="toggleSubmenu(this.parentElement); return false;">고객 지원</a>
                    <ul class="submenu">
                        <li><a th:href="@{/admin/cs/faq}" 
                               th:classappend="${activeMenu == 'faq' ? 'active' : ''}">FAQ 관리</a></li>
                        <li><a th:href="@{/admin/cs/qna}" 
                               th:classappend="${activeMenu == 'qna' ? 'active' : ''}">QnA 관리</a></li>
                    </ul>
                </li>
                
                <!-- 환경 설정 - CS는 숨김, ADM/SAD만 -->
                <li class="menu-item has-submenu"
                    th:classappend="${activeMenu != null && (activeMenu == 'settings-search-keyword' || activeMenu == 'settings-category' || activeMenu == 'settings-terms') ? 'open' : ''}"
                    sec:authorize="hasAnyRole('ADM', 'SAD')">
                    <a href="#" onclick="toggleSubmenu(this.parentElement); return false;">환경 설정</a>
                    <ul class="submenu">
                        <li><a th:href="@{/admin/settings/keyword}"
                               th:classappend="${activeMenu == 'settings-search-keyword' ? 'active' : ''}">검색어 관리</a></li>
                        <li><a th:href="@{/admin/settings/category}"
                               th:classappend="${activeMenu == 'settings-category' ? 'active' : ''}">카테고리 관리</a></li>
                        <li><a th:href="@{/admin/settings/terms}"
                               th:classappend="${activeMenu == 'settings-terms' ? 'active' : ''}">약관 관리</a></li>
                        <li><a th:href="@{/admin/dev/logs}"
                               th:classappend="${activeMenu == 'dev-logs' ? 'active' : ''}">개발 관리</a></li>
                    </ul>
                </li>
                
                <!-- 결재 - CS는 숨김, ADM/SAD만 -->
                <li class="menu-item has-submenu"
                    th:classappend="${activeMenu != null && (activeMenu == 'approval' || activeMenu == 'approval-history') ? 'open' : ''}"
                    sec:authorize="hasAnyRole('ADM', 'SAD')">
                    <a href="#" onclick="toggleSubmenu(this.parentElement); return false;">결재</a>
                    <ul class="submenu">
                        <li><a th:href="@{/admin/approval}" 
                               th:classappend="${activeMenu == 'approval' ? 'active' : ''}">결재대기</a></li>
                        <li><a th:href="@{/admin/approval/history}" 
                               th:classappend="${activeMenu == 'approval-history' ? 'active' : ''}">결재이력</a></li>
                    </ul>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- 사이드바 스크립트 Fragment -->
    <script th:fragment="sidebar-script" th:inline="javascript">
        /*<![CDATA[*/
        function toggleSubmenu(element) {
            element.classList.toggle('open');
        }
        /*]]>*/
    </script>
</body>
</html>


