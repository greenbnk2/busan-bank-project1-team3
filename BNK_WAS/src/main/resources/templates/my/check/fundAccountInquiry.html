<div th:replace="~{my/_head.html}"></div>
<main>
    <div class="main-container">
        <div class="content-wrapper">

            <div th:replace="~{my/sidebar :: sidebar('account')}"></div>

            <div class="main-content">
                <div class="content-header">
                    <h1>펀드계좌조회</h1>
                </div>

                <div style="font-size: 13px; color: #666; line-height: 1.7; padding: 15px; border: 1px solid #eee; margin-bottom: 20px;">
                    <p>대출가능금액은 해당 계좌의 순수 대출가능금액으로 인터넷 대출 신청시 대출가능금액이 달라질 수 있습니다.</p>
                    <p>펀드의 경우 현재잔액란의 표기된 금액은 기준일 현재 고시기준가격을 적용한 평가금액으로 실제지급시 차감금액과 상이할 수 있습니다.</p>
                    <p>펀드계좌의 대출가능금액 조회는 토요일, 일요일(공휴일포함) 조회 불가하며 평일 09:30 ~ 23:00 가능합니다.</p>
                    <p>조회기준선택대상의 조구구분은 로보어드바이저(포트폴리오) 펀드를 제외한 일반 펀드만을 대상으로 합니다.</p>
                    <p>로보어드바이저(포트폴리오) 펀드의 상세 정보를 원하시면 포트폴리오 조회 화면을 이용바랍니다.</p>
                </div>

                <div style="border-top: 1px solid #ccc; border-bottom: 1px solid #ccc; background:#f9f9f9; margin-bottom: 30px;">
                    <div style="display: flex; align-items: center; padding: 20px;">
                        <label style="font-weight: bold; margin-right: 30px;">조회구분</label>
                        <div style="display: flex; gap: 20px; font-size: 14px;">
                            <label style="cursor:pointer;"><input type="radio" name="queryType" value="total" checked onclick="changeViewType()"> 전액기준(세금지분포함)</label>
                            <label style="cursor:pointer;"><input type="radio" name="queryType" value="net" onclick="changeViewType()"> 불안액기준(순수익)</label>
                            <label style="cursor:pointer;"><input type="radio" name="queryType" value="method" onclick="changeViewType()"> 불안액기준(금액방식)</label>
                        </div>
                    </div>
                </div>

                <div class="table-list-wrap" th:if="${not #lists.isEmpty(accountList)}">
                    <table class="fund-result-table">
                        <colgroup>
                            <col style="width: 35%;">
                            <col style="width: 25%;">
                            <col style="width: 25%;">
                            <col style="width: 15%;">
                        </colgroup>
                        <thead>
                        <tr>
                            <th>펀드명</th>
                            <th>계좌번호</th>
                            <th id="amountHeader">평가금액 (전액)</th>
                            <th>수익률</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="fund : ${accountList}">
                            <td class="text-left" style="padding-left:20px;">
                                <strong th:text="${fund.fundName}">펀드명</strong>
                            </td>
                            <td class="text-center" th:text="${fund.acctNo}">계좌번호</td>

                            <td class="display-amount text-right" style="padding-right:20px; font-weight:bold;"
                                th:data-total="${fund.currentEvalAmount}"
                                th:data-net="${fund.afterTaxAmount}"
                                th:data-method="${fund.profitAmount}">
                                <span th:text="${#numbers.formatInteger(fund.currentEvalAmount, 0, 'COMMA')} + '원'">0원</span>
                            </td>

                            <td class="text-center"
                                th:style="${fund.yieldPct > 0} ? 'color:#d63031; font-weight:bold;' : (${fund.yieldPct < 0} ? 'color:#0984e3; font-weight:bold;' : 'color:#333; font-weight:bold;')">
                                <span th:text="${(fund.yieldPct > 0 ? '+' : '') + fund.yieldPct + '%'}">0.0%</span>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <div th:if="${#lists.isEmpty(accountList)}" style="text-align: center; padding: 50px 0; background: #f9f9f9; border: 1px solid #eee; border-radius: 8px;">
                    <img th:src="@{/images/main/ico_gnb_search.png}" alt="경고" style="width: 48px; height: 48px; margin-bottom: 20px; opacity: 0.5;">
                    <p style="font-size: 16px; font-weight: bold; color: #333;">조회하실 내역이 없습니다.</p>
                    <p style="font-size: 13px; color: #888;" th:text="|조회기준일시: ${#dates.format(#dates.createNow(), 'yyyy-MM-dd HH:mm:ss')}|">조회기준일시</p>
                </div>

            </div> </div>
    </div>
</main>
<div th:replace="~{my/_tail.html}"></div>

<script>
    function changeViewType() {
        const type = document.querySelector('input[name="queryType"]:checked').value;
        const header = document.getElementById('amountHeader');

        if(type === 'total') header.innerText = '평가금액 (전액)';
        else if(type === 'net') header.innerText = '실수령액 (불안액)';
        else if(type === 'method') header.innerText = '평가손익 (금액방식)';

        const cells = document.querySelectorAll('.display-amount');
        cells.forEach(cell => {
            let value = 0;
            if (type === 'total') value = cell.dataset.total;
            else if (type === 'net') value = cell.dataset.net;
            else if (type === 'method') value = cell.dataset.method;

            const formatted = new Intl.NumberFormat('ko-KR').format(value);
            cell.querySelector('span').innerText = formatted;

            if(type === 'method') {
                if(value > 0) cell.style.color = '#d63031';
                else if(value < 0) cell.style.color = '#0984e3';
                else cell.style.color = '#333';
            } else {
                cell.style.color = '#333';
            }
        });
    }
</script>