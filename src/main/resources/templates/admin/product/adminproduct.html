<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>펀드 목록 - 은행 펀드 상품 관리자</title>
    <link rel="stylesheet" th:href="@{/css/admin/admin_styles.css}">
    <link rel="stylesheet" th:href="@{/css/admin/adminproduct.css}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<!--
    날짜 : 2025/11/26
    이름 : 이종봉
    내용 : 펀드 목록 상세(돋보기)
-->
<body>
<!-- 사이드바 Fragment -->
<div th:replace="~{admin/_sidebar :: sidebar('product-list')}"></div>

<div class="main-content">
    <!-- 헤더 Fragment -->
    <div th:replace="~{admin/_header :: header}"></div>
    <div class="main-content-body">
        <div class="container">
            <!-- 페이지 헤더 -->
            <header class="page-header">
                <h1>펀드 목록</h1>
                <div class="header-actions">
                    <a th:href="@{/admin/product/pending}" 
                       class="btn btn-red"
                       sec:authorize="hasAnyRole('ADM', 'SAD')">펀드관리</a>
                </div>
            </header>

            <!-- 검색 섹션 -->
            <div class="search-section">
                <form th:action="@{/admin/product}" method="get" style="margin: 0;">
                    <table class="search-table">
                        <tbody>
                        <tr>
                            <td class="search-label">검색조건</td>
                            <td class="search-inputs">
                                <select class="form-select search-select-small" id="searchNameSelect" name="searchType">
                                    <option value="name">펀드명</option>
                                    <option value="code">상품코드</option>
                                    <option value="type">유형</option>
                                </select>
                                <input type="text" class="form-input search-input-large" id="searchName" name="keyword" placeholder="입력하세요" th:value="${pageRequestDTO != null ? pageRequestDTO.keyword : ''}">
                            </td>
                        </tr>
                        <tr>
                            <td class="search-label">펀드분류</td>
                            <td class="search-inputs">
                                <select class="form-select search-select-medium" id="searchCategory" name="category">
                                    <option value="">전체</option>
                                    <option value="주식형">운용중</option>
                                    <option value="채권형">운용대기</option>
                                    <option value="혼합형">운용중단</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td class="search-label">상태</td>
                            <td class="search-inputs">
                                <div class="status-radio-group">
                                    <label class="status-radio-label">
                                        <input type="radio" name="status" value="" checked>
                                        <span>전체</span>
                                    </label>
                                    <label class="status-radio-label">
                                        <input type="radio" name="status" value="운용중">
                                        <span>운용중</span>
                                    </label>
                                    <label class="status-radio-label">
                                        <input type="radio" name="status" value="운용대기">
                                        <span>운용대기</span>
                                    </label>
                                    <label class="status-radio-label">
                                        <input type="radio" name="status" value="운용중단">
                                        <span>운용중단</span>
                                    </label>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <div class="search-actions">
                        <button class="btn btn-search" type="submit">조회</button>
                        <button class="btn btn-secondary" type="button" th:onclick="|location.href='@{/admin/product}'|">초기화</button>
                    </div>
                </form>
            </div>

            <!-- 상품 목록 테이블 -->

            <div class="table-section">
                <div class="table-info">
                    <span>
                            총
                            <strong th:text="${pageResponse != null ? pageResponse.total : 0}">0</strong>건
                        </span>
                    <span class="pagination-info"
                          th:if="${pageResponse != null and pageResponse.total > 0}">
                            현재:
                            <span th:text="${pageRequestDTO.pg}">1</span> /
                            <span th:text="${(pageResponse.total + pageRequestDTO.size - 1) / pageRequestDTO.size}">1</span>
                            페이지
                        </span>
                </div>
                <table class="product-table">
                    <thead>
                    <tr>
                        <th>번호</th>
                        <th>상품코드</th>
                        <th>유형</th>
                        <th>상품명</th>
                        <th></th>
                        <th>회사명</th>
                        <th>등록일자</th>
                        <th>상태</th>
                        <th sec:authorize="hasAnyRole('ADM', 'SAD')">상품관리</th>
                    </tr>
                    </thead>
                    <tbody id="productTableBody">
                    <tr th:each="item, stat : ${dtoList}">
                        <td th:text="${pageResponse.startNo - stat.index}">1</td>
                        <td th:text="${item.fundCode}"></td>
                        <td th:text="${item.categoryName}"></td>
                        <td th:text="${item.fundName}"></td>
                        <td>
                            <button class="view-detail-btn"
                                    th:data-code="${item.fundCode}"
                                    onclick="viewProductDetail(this.dataset.code)">
                                <i class="fa fa-search"></i>
                            </button>
                        </td>
                        <td th:text="${item.operatorName}"></td>
                        <td th:text="${#temporals.format(item.regDate, 'yyyy-MM-dd')}"></td>
                        <td><span class="status-badge modifying" th:text="${item.operStatus}"></span></td>

                        <td sec:authorize="hasAnyRole('ADM', 'SAD')">
                            <div class="action-buttons">
                                <a th:href="@{/admin/product/pending(searchType='code', keyword=${item.fundCode})}" 
                                   class="btn btn-gry">펀드관리</a>
                            </div>
                        </td>

                    </tr>
                    </tbody>
                </table>
                <!-- 페이징 -->
                <div class="pagination"
                     th:if="${pageResponse != null and pageResponse.total > 0}">

                    <!-- 이전 버튼 -->
                    <button class="page-btn prev"
                            th:if="${pageResponse.prev}"
                            th:onclick="|location.href='@{/admin/product(
                            pg=${pageResponse.start - 1},
                            size=${pageRequestDTO.size},
                            searchType=${pageRequestDTO.searchType},
                            keyword=${pageRequestDTO.keyword},
                            category=${pageRequestDTO.category},
                            status=${pageRequestDTO.status}
                            )}'|">
                        &lt;
                    </button>

                    <!-- 페이지 번호 -->
                    <div class="page-numbers">
                        <button class="page-number"
                                th:each="p : ${#numbers.sequence(pageResponse.start, pageResponse.end)}"
                                th:text="${p}"
                                th:classappend="${p == pageRequestDTO.pg} ? ' active'"
                                th:onclick="|location.href='@{/admin/product(
                                pg=${p},
                                size=${pageRequestDTO.size},
                                searchType=${pageRequestDTO.searchType},
                                keyword=${pageRequestDTO.keyword},
                                category=${pageRequestDTO.category},
                                status=${pageRequestDTO.status}
                                )}'|">
                        </button>
                    </div>

                    <!-- 다음 버튼 -->
                    <button class="page-btn next"
                            th:if="${pageResponse.next}"
                            th:onclick="|location.href='@{/admin/product(
                            pg=${pageResponse.end + 1},
                            size=${pageRequestDTO.size},
                            searchType=${pageRequestDTO.searchType},
                            keyword=${pageRequestDTO.keyword},
                            category=${pageRequestDTO.category},
                            status=${pageRequestDTO.status}
                            )}'|">
                        &gt;
                    </button>
                </div>
            </div>
            <!-- 푸터 영역 -->
            <footer class="admin-footer"></footer>
        </div>
    </div>
</div>

<!-- 상품 세부사항 모달 -->
<div id="productDetailModal" class="modal">
    <div class="modal-content fund-detail-modal">
        <div class="modal-header">
            <div class="fund-detail-title">
                <h2>펀드요약정보</h2>
                <div class="fund-name-section">
                    <div class="fund-full-name" id="fundFullName"></div>
                    <div class="fund-code" id="fundCode"></div>
                    <!-- 약관.투자.간이설명서 뷰어+다운로드 -->
                    <div class="pdf-documents-section">
                        <a id="termsBtn" class="pdf-document-item" target="_blank">
                            <i class="fa fa-file-pdf"></i> <span>약관</span>
                        </a>
                        <a id="investBtn" class="pdf-document-item" target="_blank">
                            <i class="fa fa-file-pdf"></i> <span>투자설명서</span>
                        </a>
                        <a id="summaryBtn" class="pdf-document-item" target="_blank">
                            <i class="fa fa-file-pdf"></i> <span>간이투자설명서</span>
                        </a>
                    </div>

                </div>
            </div>
            <span class="close" onclick="closeModal()">&times;</span>
        </div>
        <div class="modal-body" id="modalBody">
            <!-- 상품 상세 정보가 여기에 표시됩니다 -->
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal()">닫기</button>
        </div>
    </div>
</div>

<script th:inline="javascript">
    /*<![CDATA[*/
    var productDetailData = {};
    var editUrl = /*[[@{/admin/product/edit}]]*/ '';
    function editProduct(productId) {
        location.href = editUrl + '?id=' + productId;
    }

    function viewProductDetail(fundCode) {

        fetch(`/bnk/admin/product/detail?fundCode=${fundCode}`)
            .then(response => response.json())
            .then(product => {
                window.currentProduct = product;

                if (!product) {
                    alert("상세 데이터를 찾을 수 없습니다.");
                    return;
                }

                // 헤더 영역 채우기
                document.getElementById("fundFullName").textContent = product.fundName;
                document.getElementById("fundCode").textContent = product.fundCode;

                // PDF 버튼 RUL
                const ctx = "/bnk";
                document.getElementById("termsBtn").href = ctx + "/files/" + (product.termsUrl ?? "#");
                document.getElementById("investBtn").href = ctx + "/files/" + (product.investUrl ?? "#");
                document.getElementById("summaryBtn").href = ctx + "/files/" + (product.summaryUrl ?? "#");



                const modalBody = document.getElementById('modalBody');
                modalBody.innerHTML = `
                <!-- 펀드정보 섹션 -->
                <div class="fund-info-section">
                    <!-- 회사 정보 섹션 -->
                    <div class="company-info-section">
                        <div class="company-tabs">
                            <button class="company-tab-btn active" onclick="switchCompanyTab('logo', this)">회사로고</button>
                            <button class="company-tab-btn" onclick="switchCompanyTab('overview', this)">회사개황</button>
                            <button class="company-tab-btn" onclick="switchCompanyTab('financial', this)">주요재무현황</button>
                        </div>

                        <!-- 회사로고 탭 -->
                        <div class="company-tab-content" id="companyLogoTab">
                            <div class="company-logo-container">
                                <img src="" alt="회사로고" class="company-logo-img">
                            </div>
                        </div>



                        <!-- 회사개황 탭 -->
                        <div class="company-tab-content" id="companyOverviewTab" style="display: none;">
                            <div class="company-overview-header">
                                <span class="reference-date-text">기준일:  ${product.lastModifiedDate ?? '-'}</span>
                            </div>
                            <div class="company-overview-table">
                                <div class="overview-row">
                                    <div class="overview-label">설립일</div>
                                    <div class="overview-value">${product.establishmentDate ?? '-'}</div>
                                </div>
                                <div class="overview-row">
                                    <div class="overview-label">대표전화(대표자)</div>
                                    <div class="overview-value">${product.operatorHp ?? '-'} (${product.ceoName ?? '-'})</div>
                                </div>
                                <div class="overview-row">
                                    <div class="overview-label">자본금</div>
                                    <div class="overview-value">${product.capital?.toLocaleString() ?? '-'}</div>
                                </div>
                                <div class="overview-row">
                                    <div class="overview-label">홈페이지</div>
                                    <div class="overview-value">${product.homepageUrl ?? '-'}</div>
                                </div>
                            </div>
                        </div>

                        <!-- 주요재무현황 탭 -->
                        <div class="company-tab-content" id="companyFinancialTab" style="display: none;">
                            <div class="company-financial-header">
                                <div class="financial-header-left">
                                    <span class="reference-date-text">기준일: ${product.lastModifiedDate ?? '-'}</span>
                                    <span class="unit-text">[단위: 억원, %]</span>
                                </div>
                                <button id="chartListViewBtn" class="chart-list-btn" onclick="toggleChartListView()">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px; margin-right: 5px; padding-top: 2px">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0zM3.75 12h.007v.008H3.75V12zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0zM3.75 17.25h.007v.008H3.75v-.008zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0z" />
                                    </svg>
                                    목록보기
                                </button>
                            </div>
                            <div id="chartView" style="width: 100%; height: 300px; margin: 20px 0;">
                                <canvas id="financialChart"></canvas>
                            </div>

                            <div id="tableView" class="financial-chart-container" style="display:none;">
                                <div class="financial-item">총자산: ${product.totalAsset?.toLocaleString() ?? '-'}</div>
                                <div class="financial-item">총부채: ${product.totalLiabilities?.toLocaleString() ?? '-'}</div>
                                <div class="financial-item">자본금: ${product.capital?.toLocaleString() ?? '-'}</div>
                                <div class="financial-item">자기자본: ${product.equityCapital?.toLocaleString() ?? '-'}</div>
                                <div class="financial-item">영업용순자본: ${product.operatingCapital?.toLocaleString() ?? '-'}</div>
                                <div class="financial-item">당기순이익: ${product.netIncome?.toLocaleString() ?? '-'}</div>
                            </div>
                        </div>
                    </div>

                    <div class="fund-price-section">
                    <div class="standard-price">
                        <div class="price-label">기준가</div>
                        <div class="price-value">${product.navPerUnit?.toLocaleString() ?? '-'}</div>
                    </div>

                    <!-- 전일대비 한 줄 -->
                    <div class="comparison-inline">
                        (<span class="label">전일대비</span>
                        <span class="${product.dailyChangeRate >= 0 ? 'up' : 'down'}">
                            ${product.dailyChangeRate >= 0 ? '▲' : '▼'}
                            ${(product.dailyChangeRate ?? 0).toFixed(2)}
                        </span>,
                        <span class="${product.dailyChangeRate >= 0 ? 'up' : 'down'}">
                            ${(product.dailyChangeRate ?? 0).toFixed(2)}%
                        </span>)
                    </div>

                    <!-- 전주대비 한 줄 -->
                    <div class="comparison-inline">
                        (<span class="label">전주대비</span>
                        <span class="${product.prevWeekPercent >= 0 ? 'up' : 'down'}">
                            ${product.prevWeekPercent >= 0 ? '▲' : '▼'}
                            ${(product.prevWeekChange ?? 0).toFixed(2)}
                        </span>,
                        <span class="${product.prevWeekPercent >= 0 ? 'up' : 'down'}">
                            ${(product.prevWeekPercent ?? 0).toFixed(2)}%
                        </span>)
                    </div>

                    <!-- 기준일 -->
                    <div class="reference-inline">
                        [기준일: ${product.tradeDate ?? '-'}]
                    </div>
                </div>
                    <div class="fund-details-table">
                        <table class="detail-table">
                            <tr>
                                <td>펀드유형</td>
                                <td>${product.categoryName ?? '-'}</td>
                            </tr>
                            <tr>
                                <td>투자지역</td>
                                <td>${product.investRegion ?? '-'}</td>
                            </tr>
                            <tr>
                                <td>단축코드</td>
                                <td>${product.shortCode ?? '-'}</td>
                            </tr>
                            <tr>
                                <td>총보수</td>
                                <td>${product.totalFeeRate ?? '-'}</td>
                            </tr>
                            <tr>
                                <td>최초설정일</td>
                                <td>${product.setupDate ?? '-'}</td>
                            </tr>
                            <tr>
                                <td>설정원본</td>
                                <td>${product.setupOriginAmount ?? '-'}</td>
                            </tr>
                            <tr>
                                <td>순자산총액</td>
                                <td>${product.totalNav?.toLocaleString() ?? '-'}</td>
                            </tr>
                            <tr>
                                <td>운용상태</td>
                                <td>${product.operStatus ?? '-'}</td>
                            </tr>
                        </table>
                    </div>
                </div>

                <!-- 탭 네비게이션 -->
                <div class="fund-tabs-nav">
                    <button class="fund-tab-btn active" onclick="switchFundTab('basic', this)">펀드기본정보</button>
                    <button class="fund-tab-btn" onclick="switchFundTab('chart', this)">수익률 추이차트</button>
                    <button class="fund-tab-btn" onclick="switchFundTab('price', this)">가격변동 추이</button>
                    <button class="fund-tab-btn" onclick="switchFundTab('asset', this)">자산구성내역</button>
                    <button class="fund-tab-btn" onclick="switchFundTab('settlement', this)">결산 및 상환</button>
                    <button class="fund-tab-btn" onclick="switchFundTab('disclosure', this)">공시관련</button>
                </div>

                <!-- 펀드 기본 정보 및 관련 정보 -->
                <div class="fund-detail-sections">
                    <!-- 펀드 기본 정보 -->
                    <div class="detail-section fund-tab-content" id="basicTab">
                        <h3 class="section-subtitle">펀드기본정보</h3>
                        <div class="detail-grid">
                            <div class="detail-grid-item">
                                <div class="detail-label">구분</div>
                                <div class="detail-value">${product.fundType ?? '-'}</div>
                            </div>
                            <div class="detail-grid-item">
                                <div class="detail-label">설정일</div>
                                <div class="detail-value">${product.setupDate ?? '-'}</div>
                            </div>
                            <div class="detail-grid-item">
                                <div class="detail-label">신탁회계기간</div>
                                <div class="detail-value">${product.operPeriodType || '-'}</div>
                            </div>
                            <div class="detail-grid-item">
                                <div class="detail-label">운용실적공시분류</div>
                                <div class="detail-value">${product.prfmType || '-'}</div>
                            </div>
                            <div class="detail-grid-item">
                                <div class="detail-label">최초설정기준가격</div>
                                <div class="detail-value">${product.initialNav ?? '-'}</div>
                            </div>
                            <div class="detail-grid-item">
                                <div class="detail-label">상품분류</div>
                                <div class="detail-value">${product.categoryName}</div>
                            </div>
                            <div class="detail-grid-item">
                                <div class="detail-label">분류코드</div>
                                <div class="detail-value">${product.classifyCode || '-'}</div>
                            </div>
                            <div class="detail-grid-item">
                                <div class="detail-label">투자지역구분</div>
                                <div class="detail-value">${product.investRegion}</div>
                            </div>
                            <div class="detail-grid-item">
                                <div class="detail-label">특성분류</div>
                                <div class="detail-value">${product.className || '-'}</div>
                            </div>
                            <div class="detail-grid-item">
                                <div class="detail-label">신탁기간</div>
                                <div class="detail-value">${product.operPeriodType || '-'}</div>
                            </div>
                            <div class="detail-grid-item">
                                <div class="detail-label">추가/단위구분</div>
                                <div class="detail-value">${product.isUnitType || '-'}</div>
                            </div>
                            <div class="detail-grid-item">
                                <div class="detail-label">단축코드</div>
                                <div class="detail-value">${product.shortCode}</div>
                            </div>
                            <div class="detail-grid-item">
                                <div class="detail-label">판매지역구분</div>
                                <div class="detail-value">${product.rgnType || '-'}</div>
                            </div>
                            <div class="detail-grid-item">
                                <div class="detail-label">공시/사모구분</div>
                                <div class="detail-value">${product.publicPrivateType || '-'}</div>
                            </div>
                        </div>
                    </div>

                    <!-- 관련보수 -->
                    <div class="detail-section fund-tab-content" id="basicTab">
                        <h3 class="section-subtitle">관련보수
                            <p class="table-note">( )은 주식형 유형평균보수 비율입니다.</p>
                        </h3>
                        <div class="detail-grid">
                            <div class="detail-grid-item">
                                <div class="detail-label">운용보수</div>
                                <div class="detail-value">${product.mgtFeeRate} (${product.mgtFeeRate})</div>
                            </div>
                            <div class="detail-grid-item">
                                <div class="detail-label">판매보수</div>
                                <div class="detail-value">${product.salesFeeRate} (${product.salesFeeRate})</div>
                            </div>
                            <div class="detail-grid-item">
                                <div class="detail-label">수탁보수</div>
                                <div class="detail-value">${product.trusteeFeeRate} (${product.trusteeFeeRate})</div>
                            </div>
                            <div class="detail-grid-item">
                                <div class="detail-label">일반사무관리보수</div>
                                <div class="detail-value">${product.adminFeeRate} (${product.adminFeeRate})</div>
                            </div>
                            <div class="detail-grid-item">
                                <div class="detail-label">보수합계</div>
                                <div class="detail-value">${product.totalFeeRate} (${product.totalFeeRate})</div>
                            </div>
                            <div class="detail-grid-item">
                                <div class="detail-label">총비용비율(TER)</div>
                                <div class="detail-value">${product.totalExpenseRatio} (${product.totalExpenseRatio})</div>
                            </div>
                        </div>
                    </div>

                    <!-- 관련수수료 -->
                    <div class="detail-section fund-tab-content" id="basicTab">
                        <h3 class="section-subtitle">관련수수료</h3>
                        <div class="detail-grid">
                            <div class="detail-grid-item">
                                <div class="detail-label">선취수수료</div>
                                <div class="detail-value">${product.upfrontFee}</div>
                            </div>
                            <div class="detail-grid-item">
                                <div class="detail-label">후취수수료</div>
                                <div class="detail-value">${product.postFeeRate}</div>
                            </div>
                        </div>
                    </div>

                    <!-- 관련회사 정보 -->
                    <div class="detail-section fund-tab-content" id="basicTab">
                        <h3 class="section-subtitle">관련회사 정보</h3>
                        <div class="detail-grid">
                            <div class="detail-grid-item">
                                <div class="detail-label">운용회사</div>
                                <div class="detail-value">${product.operatorName}</a></div>
                            </div>
                            <div class="detail-grid-item">
                                <div class="detail-label">일반사무관리회사</div>
                                <div class="detail-value">${product.adminCompany}</a></div>
                            </div>
                            <div class="detail-grid-item">
                                <div class="detail-label">수탁회사</div>
                                <div class="detail-value">${product.trusteeCompany}</a></div>
                            </div>
                            <div class="detail-grid-item">
                                <div class="detail-label">판매회사</div>
                                <div class="detail-value">${product.salesCompany || '-'}</div>
                            </div>
                        </div>
                    </div>

                    <!-- 수익률 추이차트 -->
                    <div class="detail-section fund-tab-content" id="chartTab" style="display: none;">
                        <div class="chart-header">
                            <h3 class="section-subtitle">수익률 추이차트</h3>
                            <div class="chart-controls">
                                <span class="unit-label">단위: 백만원, %</span>
                                <span class="separator">|</span>
                                <button class="chart-list-btn" id="returnListViewBtn" onclick="toggleReturnListView()">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px; margin-right: 5px; padding-top: 2px ">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0zM3.75 12h.007v.008H3.75V12zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0zM3.75 17.25h.007v.008H3.75v-.008zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0z" />
                                    </svg>
                                    목록보기
                                </button>
                            </div>
                        </div>

                        <!-- 조회 조건 -->
                        <div class="form-table">
                            <div class="form-row">
                                <div class="form-label">조회기간</div>
                                <div class="form-input-wrapper">
                                    <div style="display: flex; align-items: center; gap: 15px;">
                                        <div class="date-input-group">
                                            <input type="date" class="form-input date-input" id="returnStartDate">
                                            <span class="date-separator">~</span>
                                            <input type="date" class="form-input date-input" id="returnEndDate">
                                        </div>
                                        <div class="radio-group">
                                            <label class="radio-label">
                                                <input type="radio" name="chartBasis" value="daily" checked> 일일기준
                                            </label>
                                            <label class="radio-label">
                                                <input type="radio" name="chartBasis" value="monthly"> 월말기준
                                            </label>
                                        </div>
                                        <button id="returnSearchBtn" class="btn btn-search">검색</button>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-label">벤치마크 지수 선택</div>
                                <div class="form-input-wrapper">
                                    <div class="checkbox-group" style="flex-direction: row; gap: 20px;">
                                        <label class="checkbox-label">
                                            <input type="checkbox" name="benchmark" value="kospi"> KOSPI
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" name="benchmark" value="kosdaq"> KOSDAQ
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" name="benchmark" value="govt"> 국공채
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" name="benchmark" value="corp"> 회사채
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 차트 영역 -->
                        <div id="returnChartView">
                            <div class="chart-container">
                                <canvas id="returnChart" style="width: 100%; height: 400px;"></canvas>
                            </div>

                            <!-- 범례 -->
                            <div class="chart-legend">
                            <div class="legend-item">
                                <span class="legend-icon" style="width: 16px; height: 16px; display: inline-block; margin-right: 5px; vertical-align: middle;">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffc107" style="width: 100%; height: 100%;">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3v11.25A2.25 2.25 0 0 0 6 16.5h2.25M3.75 3h-1.5m1.5 0h16.5m0 0h1.5m-1.5 0v11.25A2.25 2.25 0 0 1 18 16.5h-2.25m-7.5 0h7.5m-7.5 0-1 3m8.5-3 1 3m0 0 .5 1.5m-.5-1.5h-9.5m0 0-.5 1.5m.75-9 3-3 2.148 2.148A12.061 12.061 0 0 1 16.5 7.605" />
                                    </svg>
                                </span>
                                <span>운용수익률</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-icon" style="width: 16px; height: 16px; display: inline-block; margin-right: 5px; vertical-align: middle;">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2196F3" style="width: 100%; height: 100%;">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z" />
                                    </svg>
                                </span>
                                <span>설정원본</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-icon" style="background: #4CAF50; width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 5px;"></span>
                                <span>KOSPI</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-icon" style="background: #9C27B0; width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 5px;"></span>
                                <span>KOSDAQ</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-icon" style="background: #FF69B4; width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 5px;"></span>
                                <span>국공채</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-icon" style="background: #607D8B; width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 5px;"></span>
                                <span>회사채</span>
                            </div>
                        </div>
                        </div>

                        <!-- 테이블 영역 -->
                        <div class="chart-table-container" id="returnTableView" style="display: none;">
                            <div class="chart-table-wrapper">
                                <table class="return-chart-table">
                                    <thead>
                                        <tr>
                                            <th>기준일</th>
                                            <th>설정원본</th>
                                            <th>운용수익률</th>
                                            <th>KOSPI</th>
                                            <th>KOSDAQ</th>
                                            <th>국공채</th>
                                            <th>회사채</th>
                                        </tr>
                                    </thead>
                                    <tbody id="returnTableBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- 가격변동 추이 -->
                    <div class="detail-section fund-tab-content" id="priceTab" style="display: none;">
                        <div class="chart-header">
                            <h3 class="section-subtitle">가격변동 추이</h3>
                            <div class="chart-controls">
                                <span class="unit-label">단위: %</span>
                                <span class="separator">|</span>
                                <button class="chart-list-btn" id="priceListViewBtn" onclick="togglePriceListView()">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px; margin-right: 5px; padding-top: 2px">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0zM3.75 12h.007v.008H3.75V12zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0zM3.75 17.25h.007v.008H3.75v-.008zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0z" />
                                    </svg>
                                    목록보기
                                </button>
                                <span class="separator">|</span>
                                <button class="chart-list-btn">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px; margin-right: 5px; padding-top: 2px">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" />
                                    </svg>
                                    다운로드
                                </button>
                            </div>
                        </div>

                        <!-- 조회 조건 -->
                        <div class="form-table">
                            <div class="form-row">
                                <div class="form-label">조회기간</div>
                                <div class="form-input-wrapper">
                                    <div style="display: flex; align-items: center; gap: 15px;">
                                        <div class="date-input-group">
                                            <input type="date" class="form-input date-input" id="priceStartDate">
                                            <span class="date-separator">~</span>
                                            <input type="date" class="form-input date-input" id="priceEndDate">
                                        </div>
                                        <div class="radio-group">
                                            <label class="radio-label">
                                                <input type="radio" name="priceBasis" value="daily" checked> 일일기준
                                            </label>
                                            <label class="radio-label">
                                                <input type="radio" name="priceBasis" value="monthly"> 월말기준
                                            </label>
                                        </div>
                                        <button id="priceSearchBtn" class="btn btn-search">검색</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 차트 영역 -->
                        <div id="priceChartView">
                            <div class="chart-container">
                                <canvas id="priceChart" style="width: 100%; height: 400px;"></canvas>
                            </div>

                            <!-- 범례 -->
                            <div class="chart-legend">
                                <div class="legend-item">
                                    <span class="legend-icon" style="background: #ff9800; width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 5px;"></span>
                                    <span>기준가격</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-icon" style="width: 16px; height: 16px; display: inline-block; margin-right: 5px; vertical-align: middle;">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2196F3" style="width: 100%; height: 100%;">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z" />
                                        </svg>
                                    </span>
                                    <span>설정원본</span>
                                </div>
                            </div>
                        </div>

                        <!-- 테이블 영역 -->
                        <div class="chart-table-container" id="priceTableView" style="display: none;">
                            <div class="chart-table-wrapper">
                                <div class="table-result-info" style="margin-bottom: 10px; color: #666; font-size: 14px;">
                                    검색결과: 총 22건
                                </div>
                                <table class="return-chart-table">
                                    <thead>
                                        <tr>
                                            <th>기준일자</th>
                                            <th>기준가격</th>
                                            <th>전일대비 등락</th>
                                            <th>과표기준 가격</th>
                                            <th>설정원본</th>
                                            <th>KOSPI</th>
                                            <th>KOSPI200</th>
                                            <th>KOSDAQ</th>
                                            <th>국공채(3년만기)</th>
                                            <th>회사채(3년만기)</th>
                                        </tr>
                                    </thead>
                                    <tbody id="priceTableBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- 자산구성내역 -->
                    <div class="detail-section fund-tab-content" id="assetTab" style="display: none;">
                        <h3 class="section-subtitle">자산구성내역</h3>

                        <!-- 헤더 정보 -->
                        <div style="display: flex; justify-content: flex-end; align-items: center; gap: 20px; margin-bottom: 10px;">
                            <div style="font-size: 14px; color: #666;">
                                <span>기준일자: </span>
                                <span id="assetAllocDate" style="font-weight: 500;"></span>
                            </div>
                            <div style="font-size: 14px; color: #666;">
                                <span>단위: </span>
                                <span style="font-weight: 500;">백만원, %</span>
                            </div>
                        </div>

                        <!-- 자산구성 -->
                        <div class="asset-composition-wrapper">
                            <table class="asset-composition-table">
                                <thead>
                                    <tr>
                                        <th>주식</th>
                                        <th>채권</th>
                                        <th>유동성</th>
                                        <th>기타</th>
                                    </tr>
                                </thead>
                                <tbody id="assetSummaryBody">
                                    <tr>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- 테이블 영역 -->
                        <div>

                                <!-- 하위 테이블들 -->
                                <div class="asset-detail-tables-wrapper">
                                    <!-- 자산구분 테이블 -->
                                    <table class="asset-detail-table">
                                        <thead>
                                            <tr>
                                                <th>자산구분</th>
                                                <th>비중(%)</th>
                                            </tr>
                                        </thead>
                                        <tbody id="assetCategoryBody">
                                            <tr>
                                                <td>KSE</td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>KOSDAQ</td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>기타</td>
                                                <td></td>
                                            </tr>
                                        </tbody>
                                    </table>

                                    <!-- 종목별 테이블 -->
                                    <table class="asset-detail-table">
                                        <thead>
                                            <tr>
                                                <th>종목별</th>
                                                <th>비중(%)</th>
                                            </tr>
                                        </thead>
                                        <tbody id="assetItemBody">
                                            <tr>
                                                <td>CD</td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>CP</td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>콜론</td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>예금</td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>기타</td>
                                                <td></td>
                                            </tr>
                                        </tbody>
                                    </table>

                                    <!-- 종류 테이블 -->
                                    <table class="asset-detail-table">
                                        <thead>
                                            <tr>
                                                <th>종류</th>
                                                <th>비중(%)</th>
                                            </tr>
                                        </thead>
                                        <tbody id="assetTypeBody">
                                            <tr>
                                                <td>국고채</td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>통안채</td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>금융채</td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>회사채</td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>기타</td>
                                                <td></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 결산 및 상환 -->
                    <div class="detail-section fund-tab-content" id="settlementTab" style="display: none;">
                        <div class="chart-header">
                            <h3 class="section-subtitle">결산 및 상환</h3>
                            <div class="chart-controls">
                                <span class="unit-label">단위: 백만원, %</span>
                                <span class="separator">|</span>
                                <button class="chart-list-btn">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px; margin-right: 5px; padding-top: 2px">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" />
                                    </svg>
                                    다운로드
                                </button>
                            </div>
                        </div>
                        <div class="settlement-table-container">
                            <table class="settlement-table">
                                <thead>
                                    <tr>
                                        <th rowspan="2">신탁회계기초</th>
                                        <th rowspan="2">신탁회계기말</th>
                                        <th rowspan="2">경과일수</th>
                                        <th colspan="2">기준가격(원)</th>
                                        <th rowspan="2">설정원본</th>
                                        <th rowspan="2">구분명</th>
                                    </tr>
                                    <tr>
                                        <th>기준</th>
                                        <th>과표</th>
                                    </tr>
                                </thead>
                                <tbody id="settlementBody">
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- 공시관련 -->
                    <div class="detail-section fund-tab-content" id="disclosureTab" style="display: none;">
                        <div class="chart-header">
                            <h3 class="section-subtitle">공시관련</h3>
                        </div>

                        <!-- 조회 조건 -->
                        <div class="form-table">
                            <div class="form-row">
                                <div class="form-label">조회기간</div>
                                <div class="form-input-wrapper">
                                    <div style="display: flex; align-items: center; gap: 15px;">
                                        <div class="date-input-group">
                                            <input type="date" class="form-input date-input" value="2024-08-08">
                                            <span class="date-separator">~</span>
                                            <input type="date" class="form-input date-input" value="2025-11-19">
                                        </div>
                                        <select class="form-select period-select" style="min-width: 120px;">
                                            <option value="1week">1주일</option>
                                            <option value="1month">1개월</option>
                                            <option value="3month" selected>3개월</option>
                                            <option value="6month">6개월</option>
                                            <option value="9month">9개월</option>
                                            <option value="1year">1년</option>
                                            <option value="2year">2년</option>
                                            <option value="3year">3년</option>
                                        </select>
                                        <div class="radio-group">
                                            <label class="radio-label">
                                                <input type="radio" name="disclosureType" value="adHoc"> 펀드수시공시
                                            </label>
                                            <label class="radio-label">
                                                <input type="radio" name="disclosureType" value="regular" checked> 펀드정기공시
                                            </label>
                                        </div>
                                        <button class="btn btn-search">검색</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 공시 목록 테이블 -->
                        <div class="disclosure-table-container" style="margin-top: 20px;">
                            <table class="disclosure-table">
                                <thead>
                                    <tr>
                                        <th>구분</th>
                                        <th>보고서명</th>
                                        <th>기준일</th>
                                        <th>공시대상</th>
                                        <th>정정여부</th>
                                        <th>조회</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><span class="disclosure-category-badge">정</span></td>
                                        <td>자산운용보고서(공모펀드)</td>
                                        <td>2025/09/30</td>
                                        <td>셋우리아이 3억만들기...</td>
                                        <td></td>
                                        <td>
                                            <button class="btn-icon-view">
                                                <i class="fa fa-file-pdf"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;

                console.log(product.assetAllocationList);
                // 회사 로고
                console.log("회사로고:", product.logo);
                document.querySelector("#companyLogoTab img").src = product.logo;


                // 조회기간 검색(수익률차트추이,가격변동추이)
                document.getElementById("returnSearchBtn").addEventListener("click", filterReturnData);
                document.getElementById("priceSearchBtn").addEventListener("click", filterPriceList);


                /* ===============================
                    ■ 수익률 테이블 렌더링
                ================================*/
                function renderReturnTable(product) {
                    const tbody = document.getElementById("returnTableBody");
                    tbody.innerHTML = "";

                    if (!product.returnHistoryList || product.returnHistoryList.length === 0) {
                        tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align:center; padding:15px;">
                            수익률 데이터가 없습니다.
                        </td>
                    </tr>`;
                                return;
                            }

                    product.returnHistoryList.forEach(item => {
                        tbody.innerHTML += `
                    <tr>
                        <td>${item.tradeDate || '-'}</td>
                        <td>${item.setupOriginAmount?.toLocaleString() ?? '-'}</td>
                        <td>${item.navReturn ?? '-'}</td>
                        <td>${item.kospiReturn ?? '-'}</td>
                        <td>${item.kosdaqReturn ?? '-'}</td>
                        <td>${item.govBondReturn ?? '-'}</td>
                        <td>${item.corpBondReturn ?? '-'}</td>
                    </tr>
                    `;
                            });
                        }
                /* ===============================
                    ■  가격변동 추이
                ================================*/
                function renderPriceTable(product) {
                    const tbody = document.getElementById("priceTableBody");
                    tbody.innerHTML = "";

                    if (!product.priceHistoryList || product.priceHistoryList.length === 0) {
                        tbody.innerHTML = `
                    <tr>
                        <td colspan="10" style="text-align:center; padding:15px;">
                            가격변동 데이터가 없습니다.
                        </td>
                    </tr>`;
                                return;
                            }

                    product.priceHistoryList.forEach(item => {
                        tbody.innerHTML += `
                    <tr>
                        <td>${item.tradeDate || '-'}</td>
                        <td>${item.navPerUnit?.toLocaleString() ?? '-'}</td>
                        <td>${item.dailyChangeRate ?? '-'}</td>
                        <td>${item.taxBaseNav ?? '-'}</td>
                        <td>${item.setupOriginAmount?.toLocaleString() ?? '-'}</td>
                        <td>${item.bmKospi ?? '-'}</td>
                        <td>${item.bmKospi200 ?? '-'}</td>
                        <td>${item.bmKosdaq ?? '-'}</td>
                        <td>${item.bmGovBond ?? '-'}</td>
                        <td>${item.bmCorpBond ?? '-'}</td>
                    </tr>
                    `;
                                });
                            }
                /* ===============================
                 ■ 자산구성내역 렌더링 (정답 버전)
                ================================*/
                function renderAssetAllocation(product) {

                    const list = product.assetAllocationList;
                    if (!list || list.length === 0) return;

                    // 1) 기준일
                    document.getElementById("assetAllocDate").textContent =
                        list[0].allocDate ?? '-';

                    let stock = 0, bond = 0, liquid = 0, etc = 0;

                    const categoryRows = []; // 주식 (자산구분)
                    const itemRows = [];     // 유동성 (종목별)
                    const typeRows = [];     // 채권 (종류)

                    list.forEach(item => {

                        const fullCat = item.assetCategory; // "주식-KOSDAQ"
                        const [mainCat, subCat] = fullCat.split("-"); // mainCat="주식", subCat="KOSDAQ"
                        const val = item.weightPercent ?? 0;

                        // 대분류 합계
                        if (mainCat === "주식") stock += val;
                        else if (mainCat === "채권") bond += val;
                        else if (mainCat === "유동성") liquid += val;
                        else etc += val;

                        // 하위 테이블 분기
                        if (mainCat === "주식") {
                            categoryRows.push(`<tr><td>${subCat}</td><td>${val}</td></tr>`);
                        }
                        else if (mainCat === "유동성") {
                            itemRows.push(`<tr><td>${subCat}</td><td>${val}</td></tr>`);
                        }
                        else if (mainCat === "채권") {
                            typeRows.push(`<tr><td>${subCat}</td><td>${val}</td></tr>`);
                        }
                    });

                    // 상단 요약
                    document.querySelector("#assetSummaryBody tr").innerHTML = `
                        <td>${stock.toFixed(2)}</td>
                        <td>${bond.toFixed(2)}</td>
                        <td>${liquid.toFixed(2)}</td>
                        <td>${etc.toFixed(2)}</td>
                    `;

                    // 하위 테이블
                    document.getElementById("assetCategoryBody").innerHTML = categoryRows.join("");
                    document.getElementById("assetItemBody").innerHTML = itemRows.join("");
                    document.getElementById("assetTypeBody").innerHTML = typeRows.join("");
                }





                /* ===============================
                    ■ 결산 및 상환 테이블 렌더링
                ================================*/
                function renderSettlementTable(product) {

                    const tbody = document.getElementById("settlementBody");

                    // 초기화
                    tbody.innerHTML = "";

                    if (!product.settlementList || product.settlementList.length === 0) {
                        tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align:center; padding:20px;">
                            결산 및 상환 데이터가 없습니다.
                        </td>
                    </tr>`;
                                return;
                            }

                    product.settlementList.forEach(item => {
                        const row = `
                    <tr>
                        <td>${item.settleStartDate || '-'}</td>
                        <td>${item.settleDate || '-'}</td>
                        <td>${item.elapsedDays ?? '-'}</td>
                        <td>${item.settleNav?.toLocaleString() || '-'}</td>
                        <td>${item.settleTaxNav?.toLocaleString() || '-'}</td>
                        <td>${item.setupOriginAmount?.toLocaleString() || '-'}</td>
                        <td>${item.settleType || '-'}</td>
                    </tr>
                `;
                                tbody.insertAdjacentHTML("beforeend", row);
                            });
                        }

                // 수익률 차트 조회기간
                function filterReturnData() {

                    if (!product || !product.returnHistoryList) return;

                    const start = document.getElementById("returnStartDate").value;
                    const end = document.getElementById("returnEndDate").value;

                    if (!start || !end) {
                        alert("조회기간을 선택해주세요.");
                        return;
                    }

                    // 날짜 비교를 위해 문자열 → 숫자로 변환
                    const startNum = Number(start.replace(/-/g, ""));
                    const endNum = Number(end.replace(/-/g, ""));

                    // 조건에 맞는 데이터 필터
                    let filtered = product.returnHistoryList.filter(item => {
                        const dateNum = Number(item.tradeDate.replace(/-/g, ""));
                        return dateNum >= startNum && dateNum <= endNum;
                    });

                    // 2) 월말 기준
                    const basis = document.querySelector('input[name="chartBasis"]:checked').value;

                    if (basis === 'monthly') {
                        const monthly = [];

                        filtered.forEach(item => {
                            const month = item.tradeDate.substring(0, 7);
                            const last  = monthly[monthly.length - 1];

                            if (!last || last.tradeDate.substring(0, 7) !== month) {
                                monthly.push(item);
                            } else {
                                if (item.tradeDate > last.tradeDate) {
                                    monthly[monthly.length - 1] = item;
                                }
                            }
                        });

                        filtered = monthly;
                    }


                    // 테이블 갱신
                    renderReturnTable({ returnHistoryList: filtered });

                    // 차트 갱신 (사용하던 그대로)
                    updateReturnChartByFiltered(filtered);
                }

                // 가격변동 추이 조회기간
                function filterPriceList() {

                    if (!product || !product.priceHistoryList) return;

                    // ★ 문제 원인 해결: ID로 정확히 가져오기
                    const start = document.getElementById("priceStartDate").value;
                    const end   = document.getElementById("priceEndDate").value;

                    if (!start || !end) {
                        alert("조회기간을 선택해주세요.");
                        return;
                    }

                    const startNum = Number(start.replace(/-/g, ""));
                    const endNum = Number(end.replace(/-/g, ""));

                    let list = product.priceHistoryList;

                    // 1) 기간 필터
                    let filtered = list.filter(item => {
                        const d = Number(item.tradeDate.replace(/-/g, ""));
                        return d >= startNum && d <= endNum;
                    });

                    // 2) 월말 기준
                    const basis = document.querySelector('input[name="priceBasis"]:checked').value;

                    if (basis === 'monthly') {
                        const monthly = [];

                        filtered.forEach(item => {
                            const month = item.tradeDate.substring(0, 7);
                            const last  = monthly[monthly.length - 1];

                            if (!last || last.tradeDate.substring(0, 7) !== month) {
                                monthly.push(item);
                            } else {
                                if (item.tradeDate > last.tradeDate) {
                                    monthly[monthly.length - 1] = item;
                                }
                            }
                        });

                        filtered = monthly;
                    }

                    // 3) 테이블 갱신
                    renderPriceTable({ priceHistoryList: filtered });

                    // 4) 차트 갱신
                    updatePriceChartByFiltered(filtered);
                }

                //  수익률 차트
                function updateReturnChartByFiltered(list) {

                    if (!list || list.length === 0) {
                        // 데이터 없을 때 차트만 초기화
                        returnChart.data.labels = [];
                        returnChart.data.datasets.forEach(ds => ds.data = []);
                        returnChart.update();
                        return;
                    }

                    const labels = list.map(i => i.tradeDate);
                    const navReturns = list.map(i => i.navReturn ?? 0);
                    const setupOriginAmounts = list.map(i => i.setupOriginAmount ?? 0);

                    returnChart.data.labels = labels;

                    // 기본 두 개(운용수익률, 설정원본) 갱신
                    returnChart.data.datasets[0].data = navReturns;
                    returnChart.data.datasets[1].data = setupOriginAmounts;

                    // 벤치마크 재계산
                    updateChart(); // ← 기존 함수 그대로 호출하면 됨

                    returnChart.update();
                }
                // 가격변동 차트
                function updatePriceChartByFiltered(list) {

                    if (!list || list.length === 0) {
                        priceChart.data.labels = [];
                        priceChart.data.datasets.forEach(ds => ds.data = []);
                        priceChart.update();
                        return;
                    }

                    const labels = list.map(i => i.tradeDate);
                    // 기본 두 개(기준가격, 설정원본) 갱신
                    const navList   = list.map(i => i.navPerUnit ?? 0);           // 기준가격
                    const setupList = list.map(i => i.setupOriginAmount ?? 0);    // 설정원본

                    priceChart.data.labels = labels;

                    // dataset 0 = 기준가격
                    priceChart.data.datasets[0].data = navList;

                    // dataset 1 = 설정원본
                    priceChart.data.datasets[1].data = setupList;

                    priceChart.update();
                }

                // 수익률 추이차트
                renderReturnTable(product);
                // 가격변동 추이차트
                renderPriceTable(product);
                // 자산 구성 내역
                renderAssetAllocation(product);
                // 결산 및 상환 테이블 실행
                renderSettlementTable(product);
                // 자동 날짜 세팅
                setDefaultDateRange("return", product.returnHistoryList);
                setDefaultDateRange("price", product.priceHistoryList);

                // 모달 열기
                document.getElementById("productDetailModal").classList.add("active");
            })
            .catch(error => {
                console.error(error);
                alert("상세 정보 조회 중 오류 발생.");
            });
    }

    let returnChart = null;
    let priceChart = null;
    let assetChart = null;

    // 벤치마크 지수 데이터 (샘플 데이터 - 날짜에 맞춤)
    const benchmarkData = {
        kospi: [],
        kosdaq: [],
        govt: [],
        corp: []
    };

    // 벤치마크 지수 색상
    const benchmarkColors = {
        kospi: '#4CAF50',
        kosdaq: '#9C27B0',
        govt: '#FF69B4', // 핑크색
        corp: '#607D8B'
    };

    function fillBenchmarkData(list) {
        benchmarkData.kospi  = list.map(i => i.kospiReturn ?? 0);
        benchmarkData.kosdaq = list.map(i => i.kosdaqReturn ?? 0);
        benchmarkData.govt   = list.map(i => i.govBondReturn ?? 0);
        benchmarkData.corp   = list.map(i => i.corpBondReturn ?? 0);
    }


    function updateChart() {
        if (!returnChart) return;

        // 1) 기존 DB 기반 차트 데이터 (운용수익률/설정원본) 유지
        const baseDatasets = [
            returnChart.data.datasets[0], // 운용수익률(DB 데이터)
            returnChart.data.datasets[1]  // 설정원본(DB 데이터)
        ];

        // 2) 선택된 벤치마크 읽기
        const selectedBenchmarks = [];
        const modal = document.getElementById('productDetailModal');
        const checkboxes = modal.querySelectorAll('input[name="benchmark"]:checked');

        checkboxes.forEach(cb => selectedBenchmarks.push(cb.value));

        // 3) 벤치마크 데이터 추가
        selectedBenchmarks.forEach(benchmark => {
            const data = benchmarkData[benchmark];
            const color = benchmarkColors[benchmark];
            const label =
                benchmark === 'kospi' ? 'KOSPI' :
                    benchmark === 'kosdaq' ? 'KOSDAQ' :
                        benchmark === 'govt' ? '국공채' : '회사채';

            baseDatasets.push({
                label: label,
                type: 'line',
                data: data,
                borderColor: color,
                backgroundColor: 'transparent',
                borderWidth: 2,
                pointRadius: 4,
                pointHoverRadius: 6,
                pointBackgroundColor: color,
                pointBorderColor: '#ffffff',
                pointBorderWidth: 2,
                pointHoverBorderWidth: 2,
                pointStyle: 'circle',
                yAxisID: 'y',
                order: 1
            });
        });

        // 4) 차트 업데이트
        returnChart.data.datasets = baseDatasets;
        returnChart.update();
    }


    function initReturnChart() {
        const ctx = document.getElementById('returnChart');
        if (!ctx) return;

        // 기존 차트가 있으면 제거
        if (returnChart) {
            returnChart.destroy();
        }

        // 날짜 라벨 (샘플 데이터 - 이미지 기준)
        const list = window.currentProduct.returnHistoryList || [];
        const labels = list.map(item => item.tradeDate);
        const navReturns = list.map(item => item.navReturn ?? 0);
        const setupOriginAmounts = list.map(item => item.setupOriginAmount ?? 0);


        const minReturn = Math.min(...navReturns);
        const maxReturn = Math.max(...navReturns);

        const minSetup = Math.min(...setupOriginAmounts);
        const maxSetup = Math.max(...setupOriginAmounts);

        // 벤치마크 데이터
        fillBenchmarkData(list);


        returnChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: '운용수익률',
                        type: 'line',
                        data: navReturns,
                        borderColor: '#ffc107',
                        backgroundColor: 'transparent',
                        borderWidth: 2,
                        borderDash: [],
                        pointRadius: 0,
                        pointHoverRadius: 4,
                        pointBackgroundColor: '#ffc107',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        yAxisID: 'y',
                        order: 1
                    },
                    {
                        label: '설정원본',
                        type: 'bar',
                        data: setupOriginAmounts,
                        backgroundColor: '#2196F3',
                        borderColor: '#2196F3',
                        borderWidth: 0,
                        yAxisID: 'y1',
                        order: 2,
                        barThickness: 40
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    mode: 'index',
                    intersect: false
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        enabled: true
                    }
                },
                scales: {
                    x: {
                        type: 'category',
                        grid: {
                            display: true,
                            color: '#f0f0f0',
                            drawBorder: false
                        },
                        ticks: {
                            color: '#666',
                            font: {
                                size: 11},
                                maxTicksLimit: 6,   // 날짜 6개만
                        }
                    },
                    y: {
                        type: 'linear',
                        position: 'left',
                        min: minReturn,
                        max: maxReturn,
                        ticks: {
                            stepSize: 2,
                            color: '#666',
                            font: {
                                size: 11
                            },
                            callback: v => Number(v).toFixed(1) // ★ 소수점 한 자리만
                        },
                        grid: {
                            display: true,
                            color: '#f0f0f0',
                            drawBorder: false
                        }
                    },
                    y1: {
                        type: 'linear',
                        position: 'right',
                        min: minSetup,
                        max: maxSetup,
                        ticks: {
                            maxTicksLimit: 8,
                            stepSize: 190,
                            color: '#666',
                            font: {
                                size: 11
                            },
                            callback: function(value) {
                                const rounded = Math.round(value / 100) * 100;
                                return rounded.toLocaleString();
                            }
                        },
                        grid: {
                            display: false,
                            drawBorder: false
                        }
                    }
                }
            }
        });

        // 벤치마크 체크박스 이벤트 리스너 추가 (기존 리스너 제거 후 재추가)
        const modal = document.getElementById('productDetailModal');
        if (modal) {
            modal.querySelectorAll('input[name="benchmark"]').forEach(checkbox => {
                // 기존 리스너 제거
                checkbox.removeEventListener('change', updateChart);
                // 새 리스너 추가
                checkbox.addEventListener('change', updateChart);
            });
        }
    }

    function initPriceChart() {
        const ctx = document.getElementById('priceChart');
        if (!ctx) return;

        // 기존 차트가 있으면 제거
        if (priceChart) {
            priceChart.destroy();
        }

        // 날짜 라벨 (샘플 데이터)
        const list = window.currentProduct.priceHistoryList || [];
        const labels = list.map(item => item.tradeDate);
        const navList = list.map(item => item.navPerUnit ?? 0);
        const setupList = list.map(item => item.setupOriginAmount ?? 0);

        // --- 축 계산 ---
        const minPrice = Math.min(...navList);
        const maxPrice = Math.max(...navList);

        const minSetup = Math.min(...setupList);
        const maxSetup = Math.max(...setupList);


        priceChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: '기준가격',
                        type: 'line',
                        data: navList,
                        borderColor: '#ff9800',
                        backgroundColor: 'transparent',
                        borderWidth: 2,
                        borderDash: [],
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        pointBackgroundColor: '#ff9800',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointHoverBorderWidth: 2,
                        pointStyle: 'circle',
                        yAxisID: 'y',
                        order: 1
                    },
                    {
                        label: '설정원본',
                        type: 'bar',
                        data: setupList,
                        backgroundColor: '#2196F3',
                        borderColor: '#2196F3',
                        borderWidth: 0,
                        yAxisID: 'y1',
                        order: 2,
                        barThickness: 40
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    mode: 'index',
                    intersect: false
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        enabled: true
                    }
                },
                scales: {
                    x: {
                        type: 'category',
                        grid: {
                            display: true,
                            color: '#f0f0f0',
                            drawBorder: false
                        },
                        ticks: {
                            color: '#666',
                            font: {
                                size: 12
                            },
                            maxTicksLimit: 6,   // 날짜 6개만
                        }
                    },
                    y: {
                        type: 'linear',
                        position: 'left',
                        min: minPrice -5,
                        max: maxPrice +5,
                        ticks: {
                            stepSize: 400,
                            color: '#666',
                            font: {
                                size: 11
                            }
                        },
                        grid: {
                            display: true,
                            color: '#f0f0f0',
                            drawBorder: false
                        }
                    },
                    y1: {
                        type: 'linear',
                        position: 'right',
                        min: minSetup,
                        max: maxSetup,
                        ticks: {
                            maxTicksLimit: 8,
                            stepSize: 190,
                            color: '#666',
                            font: {
                                size: 11
                            },
                            callback: function (value) {
                                const rounded = Math.round(value / 100) * 100;
                                return rounded.toLocaleString();
                            }
                        },
                        grid: {
                            display: false,
                            drawBorder: false
                        }
                    }
                }
            }
        });
    }

    let financialChart = null;

    function initFinancialChart() {
        const ctx = document.getElementById('financialChart');
        if (!ctx) return;

        const product = window.currentProduct;
        if (!product) return;

        // 기존 차트가 있으면 제거
        if (financialChart) {
            financialChart.destroy();
        }

        const dataValues = [
            product.netIncome / 100000000,        // 당기순이익
            product.totalAsset / 100000000,       // 총자산
            product.totalLiabilities / 100000000, // 총부채
            product.capital / 100000000,          // 자본금
            product.equityCapital / 100000000     // 자기자본금
        ];


        financialChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['당기순이익', '총자산', '총부채', '자본금', '자기자본금', '영업용순자본비율'],
                datasets: [{
                    label: '억원',
                    data: dataValues,
                    backgroundColor: [
                        '#ff6b35',  // 당기순이익 - 주황색
                        '#2196F3',  // 총자산 - 파란색
                        '#4caf50',  // 총부채 - 초록색
                        '#9c27b0',  // 자본금 - 보라색
                        '#ff6b35',  // 자기자본금 - 주황색
                        'transparent'  // 영업용순자본비율 - 막대 없음
                    ],
                    borderColor: [
                        '#ff6b35',
                        '#2196F3',
                        '#4caf50',
                        '#9c27b0',
                        '#ff6b35',
                        'transparent'
                    ],
                    borderWidth: 0,
                    maxBarThickness: 15
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                categoryPercentage: 0.55,
                barPercentage: 0.98,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        enabled: true
                    }
                },
                scales: {
                    x: {
                        beginAtZero: true,
                        min: 0,
                        max: 1000,
                        ticks: {
                            stepSize: 1000,
                            callback: function(value) {
                                return value.toLocaleString();
                            }
                        },
                        grid: {
                            color: '#f0f0f0'
                        }
                    },
                    y: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            font: {
                                size: 13
                            }
                        }
                    }
                }
            }
        });
    }

    function toggleChartListView() {
        const chartView = document.getElementById('chartView');
        const tableView = document.getElementById('tableView');
        const btn = document.getElementById('chartListViewBtn');

        if (chartView && tableView && btn) {
            if (chartView.style.display === 'none') {
                // 차트 보기
                chartView.style.display = 'block';
                tableView.style.display = 'none';
                btn.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px; margin-right: 5px; padding-top: 2px">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0zM3.75 12h.007v.008H3.75V12zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0zM3.75 17.25h.007v.008H3.75v-.008zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0z" />
                        </svg>
                        목록보기
                    `;
            } else {
                // 목록 보기
                chartView.style.display = 'none';
                tableView.style.display = 'block';
                btn.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px; margin-right: 5px; padding-top: 2px">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z" />
                        </svg>
                        차트 보기
                    `;
            }
        }
    }

    function togglePriceListView() {
        const chartView = document.getElementById('priceChartView');
        const tableView = document.getElementById('priceTableView');
        const btn = document.getElementById('priceListViewBtn');


        if (chartView && tableView && btn) {
            if (chartView.style.display === 'none') {
                // 차트 보기
                chartView.style.display = 'block';
                tableView.style.display = 'none';
                btn.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px; margin-right: 5px; padding-top: 2px">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0zM3.75 12h.007v.008H3.75V12zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0zM3.75 17.25h.007v.008H3.75v-.008zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0z" />
                        </svg>
                        목록보기
                    `;
            } else {
                // 목록 보기
                chartView.style.display = 'none';
                tableView.style.display = 'block';
                btn.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px; margin-right: 5px; padding-top: 2px">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z" />
                        </svg>
                        차트 보기
                    `;
            }
        }
    }

    function toggleReturnListView() {
        const chartView = document.getElementById('returnChartView');
        const tableView = document.getElementById('returnTableView');
        const btn = document.getElementById('returnListViewBtn');

        if (chartView && tableView && btn) {
            if (chartView.style.display === 'none') {
                // 차트 보기
                chartView.style.display = 'block';
                tableView.style.display = 'none';
                btn.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px; margin-right: 5px; padding-top: 2px">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0zM3.75 12h.007v.008H3.75V12zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0zM3.75 17.25h.007v.008H3.75v-.008zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0z" />
                        </svg>
                        목록보기
                    `;
            } else {
                // 목록 보기
                chartView.style.display = 'none';
                tableView.style.display = 'block';
                btn.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px; margin-right: 5px; padding-top: 2px">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z" />
                        </svg>
                        차트 보기
                    `;
            }
        }
    }

    function switchCompanyTab(tabName, element) {
        // 모든 탭 버튼 비활성화
        document.querySelectorAll('.company-tab-btn').forEach(btn => btn.classList.remove('active'));
        // 모든 탭 콘텐츠 숨기기
        document.querySelectorAll('.company-tab-content').forEach(content => content.style.display = 'none');

        // 선택한 탭 활성화
        if (element) {
            element.classList.add('active');
        }

        // 해당 탭 콘텐츠 표시
        const tabContent = document.getElementById('company' + tabName.charAt(0).toUpperCase() + tabName.slice(1) + 'Tab');
        if (tabContent) {
            tabContent.style.display = 'block';

            // 주요재무현황 탭인 경우 차트 초기화
            if (tabName === 'financial') {
                setTimeout(() => {
                    initFinancialChart();
                }, 100);
            }
        }
    }

    function switchFundTab(tabName, element) {
        // 모든 탭 버튼 비활성화
        document.querySelectorAll('.fund-tab-btn').forEach(btn => btn.classList.remove('active'));
        // 모든 탭 콘텐츠 숨기기
        document.querySelectorAll('.fund-tab-content').forEach(content => content.style.display = 'none');

        // 선택한 탭 활성화
        if (element) {
            element.classList.add('active');
        }

        // 펀드 기본정보 탭을 클릭한 경우
        if (tabName === 'basic') {
            // 펀드 기본정보와 관련 정보 모두 표시
            document.querySelectorAll('#basicTab').forEach(content => {
                content.style.display = 'block';
            });
        } else {
            // 다른 탭을 클릭한 경우 해당 탭 콘텐츠만 표시
            const tabContent = document.getElementById(tabName + 'Tab');
            if (tabContent) {
                tabContent.style.display = 'block';

                // 차트 탭인 경우 차트 초기화
                if (tabName === 'chart') {
                    setTimeout(() => {
                        initReturnChart();
                    }, 100);
                }

                // 가격변동 추이 탭인 경우 차트 초기화
                if (tabName === 'price') {
                    setTimeout(() => {
                        initPriceChart();
                    }, 100);
                }

            }
        }
    }

    function switchTab(tabName, element) {
        // 모든 탭 버튼과 콘텐츠 비활성화
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

        // 선택한 탭 활성화
        if (element) {
            element.classList.add('active');
        } else {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                if (btn.textContent.trim() === (tabName === 'basic' ? '펀드기본정보' :
                    tabName === 'fees' ? '관련보수' :
                        tabName === 'charges' ? '관련수수료' : '관련회사 정보')) {
                    btn.classList.add('active');
                }
            });
        }
        document.getElementById(tabName + 'Tab').classList.add('active');
    }

    function closeModal() {
        document.getElementById('productDetailModal').classList.remove('active');
    }

    // 상품명 35자로 제한
    function truncateProductNames() {
        const productNameLinks = document.querySelectorAll('.product-name-link');
        productNameLinks.forEach(link => {
            // 원본 텍스트 가져오기 (title이 있으면 title 사용, 없으면 textContent 사용)
            let fullText = link.getAttribute('title') || link.textContent.trim();

            // title 속성이 없으면 전체 텍스트를 title로 설정
            if (!link.getAttribute('title')) {
                link.setAttribute('title', fullText);
            }

            // 35자 초과 시 말줄임표 추가
            if (fullText.length > 35) {
                link.textContent = fullText.substring(0, 35) + '...';
            } else {
                link.textContent = fullText;
            }
        });
    }

    // 페이지 로드 시 실행
    document.addEventListener('DOMContentLoaded', function() {
        truncateProductNames();
    });

    /* ===========================================================
    ★★★ 2) 날짜 자동 계산 함수 (필수)
    =========================================================== */
    function setDefaultDateRange(prefix, dataList) {
        if (!dataList || dataList.length === 0) return;

        const sorted = [...dataList].sort((a, b) =>
            Number(a.tradeDate.replace(/-/g, "")) - Number(b.tradeDate.replace(/-/g, ""))
        );

        const endDate = sorted[sorted.length - 1].tradeDate;

        const endObj = new Date(endDate);
        const startObj = new Date(endObj);
        startObj.setMonth(startObj.getMonth() - 1);

        const startDate = startObj.toISOString().slice(0, 10);

        document.getElementById(prefix + "StartDate").value = startDate;
        document.getElementById(prefix + "EndDate").value = endDate;
    }


    /* ===========================================================
        ★★★ 3) daily/monthly 전환 자동 검색 (수익률/가격변동 공통)
    =========================================================== */
    document.addEventListener("DOMContentLoaded", () => {
        // 수익률
        document.querySelectorAll('input[name="chartBasis"]').forEach(r => {
            r.addEventListener("change", () => {
                document.getElementById("returnSearchBtn").click();
            });
        });

        // 가격변동
        document.querySelectorAll('input[name="priceBasis"]').forEach(r => {
            r.addEventListener("change", () => {
                document.getElementById("priceSearchBtn").click();
            });
        });
    });


    /*]]>*/
</script>
<!-- 사이드바 스크립트 -->
<div th:replace="~{admin/_sidebar :: sidebar-script}"></div>
</body>
</html>


